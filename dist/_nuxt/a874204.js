(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{1377:function(e,t,n){var content=n(1401);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(36).default)("3aa34269",content,!0,{sourceMap:!1})},1380:function(e,t,n){"use strict";n.r(t);var o=n(742),r=n(1276),c=n(1342),l=n(1351),d=n(503),f=n(393),h=n(507),v=n(502),x=n(1341),m=n(128),_=n(1340),k=n(22),y=(n(98),n(111),n(1396)),w=n(527),C=n(1381),M={components:{VueQrcode:n.n(C).a},data:function(){return{mixinMessengerLogo:"https://static.fox.one/image/icon_mixin@32x32.png",qrUrl:"",qrLoaded:!1,qrScaned:!1,accessToken:null,outputs:null,client:null}},computed:{connectMixinDialog:{get:function(){return this.$store.state.connectMixinDialog},set:function(e){this.$store.commit("toggleConnectMixin",e)}},mixinConnected:{get:function(){return this.$store.state.mixinConnected},set:function(e){this.$store.commit("connectMixin",e)}}},mounted:function(){var e=this;return Object(k.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.client=e.auth();case 1:case"end":return t.stop()}}),t)})))()},watch:{connectMixinDialog:function(e){e&&(this.client=this.auth())}},methods:{qrAfterSuccess:function(){var e=this;this.qrScaned=!0,setTimeout((function(){e.qrUrl="",e.connectMixinDialog=!1}),1e3)},redirect:function(e){location.href=e},auth:function(){var e,t=this;Object(y.a)({clientId:"a13f4c77-5cfc-4368-a2d6-33f07037ae9e",scope:"PROFILE:READ",pkce:!0},{onShowUrl:function(e){t.qrUrl=e,t.qrLoaded=!0},onError:function(e){t.connectMixinDialog=!1,console.error(e)},onSuccess:(e=Object(k.a)(regeneratorRuntime.mark((function e(data){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.accessToken=data,t.qrAfterSuccess(),e.next=4,Object(w.h)(data);case 4:return n=e.sent,t.mixinConnected=!0,t.$store.commit("connectMixin",!0),t.$store.commit("setOauthUser",n),localStorage.setItem("access_token",data),localStorage.setItem("oauth_user",JSON.stringify(n)),e.abrupt("return");case 11:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})})}}},O=M,S=(n(1400),n(69)),component=Object(S.a)(O,(function(){var e=this,t=e._self._c;return t(l.a,{staticClass:"dialog-css",attrs:{"max-width":"500px","overlay-opacity":"0.5"},model:{value:e.connectMixinDialog,callback:function(t){e.connectMixinDialog=t},expression:"connectMixinDialog"}},[e.$vuetify.breakpoint.mobile?t(m.a,{staticClass:"align-self-start px-9 py-8"},[t(x.a,{staticClass:"d-flex flex-column mb-0"},[t(c.a,{staticClass:"align-center d-flex flex-row pa-0 mb-2"},[t(_.a),e._v(" "),t(o.a,{attrs:{icon:""},on:{click:function(t){e.connectMixinDialog=!1}}},[t(d.a,{attrs:{color:"black"}},[e._v(" mdi-close ")])],1)],1),e._v(" "),e.qrLoaded?t(c.a,{staticClass:"d-flex justify-center oauth-qr-background"},[t(o.a,{attrs:{elevation:"0",color:"#ebf8ff"},on:{click:function(t){return e.redirect(e.qrUrl)}}},[t(f.a,{staticClass:"mr-1",attrs:{src:e.mixinMessengerLogo}}),e._v(" "),t("span",[e._v(" "+e._s(e.$t("mixin_oauth_mobile_title"))+" ")])],1)],1):e._e()],1)],1):t(m.a,{staticClass:"align-self-start px-9 py-8"},[t(x.a,{staticClass:"d-flex flex-column mb-0"},[t(c.a,{staticClass:"align-center d-flex flex-row pa-0 mb-2"},[t(_.a),e._v(" "),t(o.a,{attrs:{icon:""},on:{click:function(t){e.connectMixinDialog=!1}}},[t(d.a,{attrs:{color:"black"}},[e._v(" mdi-close ")])],1)],1),e._v(" "),e.qrLoaded?t(c.a,{staticClass:"py-6 d-flex justify-center oauth-qr-background"},[t(r.a,{attrs:{"max-width":"200px"}},[t(x.a,[e.qrUrl?t("vue-qrcode",{attrs:{value:e.qrUrl,options:{width:200}}}):e._e(),e._v(" "),t(h.a,{attrs:{opacity:"0",absolute:""}},[e.qrScaned?e._e():t(f.a,{staticClass:"mixin-logo-overlay",attrs:{src:e.mixinMessengerLogo}}),e._v(" "),e.qrScaned?t(d.a,{staticClass:"oauth-qr-scanned",attrs:{size:"64px"}},[e._v("\n                mdi-checkbox-marked-circle\n              ")]):e._e()],1)],1)],1)],1):e._e(),e._v(" "),e.qrLoaded?e._e():t(c.a,{staticClass:"my-10 d-flex justify-center"},[t(v.a,{attrs:{indeterminate:"",color:"primary"}})],1),e._v(" "),t("div",{staticClass:"my-5"},[t(c.a,{staticClass:"d-flex justify-start"},[t("span",{staticClass:"oauth-guide-title"},[e._v("\n            "+e._s(e.$t("mixin_oauth_title"))+"\n          ")])]),e._v(" "),t(c.a,{staticClass:"d-flex justify-start"},[t("span",{staticClass:"oauth-guide-text"},[e._v("\n            "+e._s(e.$t("mixin_oauth_text"))+"\n          ")])])],1)],1)],1)],1)}),[],!1,null,"36e3777e",null);t.default=component.exports},1396:function(e,t,n){"use strict";n.d(t,"a",(function(){return C}));var o=n(83),r=n(84),c=(n(48),n(106),n(12),n(131),n(1466),n(1467),n(1468),n(1469),n(1470),n(1471),n(1472),n(1473),n(1474),n(1475),n(1476),n(1477),n(1478),n(1479),n(1480),n(1481),n(1482),n(1483),n(1484),n(1485),n(1486),n(1487),n(1488),n(1489),n(1490),n(98),n(1491)),l=n(1492),d=n(1493),f=n(178),h=n(1494),v=n.n(h),x=n(1496),m=n.n(x),_=n(145),k=n.n(_);function y(e){return e.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function w(){var e=function(e){for(var text="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",i=0;i<e;i++)text+=t.charAt(Math.floor(Math.random()*t.length));return text}(32);return{verifier:y(btoa(e)),challenge:y(v()(e).toString(m.a))}}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n="https://api.mixin.one",o="wss://blaze.mixin.one",r=n,c=o,l=new M(r,c),d=!1,f=e.pkce?w():{},h=f.challenge,v=void 0===h?"":h,x=f.verifier,m=void 0===x?"":x,_=function(n){var o,c,l,f,data=n.data;if(400===(null==n||null===(o=n.error)||void 0===o?void 0:o.code)||10002===(null==n||null===(c=n.error)||void 0===c?void 0:c.code))return null===(f=t.onError)||void 0===f||f.call(t,null==n?void 0:n.error),!0;if(!data)return!1;if(data.authorization_code.length>16){var h;if(e.pkce)k.a.post("/oauth/token",{client_id:e.clientId,code_verifier:m,code:data.authorization_code},{baseURL:r}).then((function(data){var e,n,o,r,c=null==data||null===(e=data.data)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.access_token;c?null===(o=t.onSuccess)||void 0===o||o.call(t,c):null===(r=t.onError)||void 0===r||r.call(t,{description:"Get PKCE access token error"})})).catch((function(e){var n;null===(n=t.onError)||void 0===n||n.call(t,e)}));else null===(h=t.onSuccess)||void 0===h||h.call(t,data.authorization_code);return!0}return d||(null===(l=t.onShowUrl)||void 0===l||l.call(t,"mixin://codes/"+data.code_id),d=!0),!1};return l.connect(_,e.clientId,e.scope,v),l}var M=function(){function e(t,n){Object(o.a)(this,e),this.api=t,this.endpoint=n}return Object(r.a)(e,[{key:"disconnect",value:function(){this.ws.close()}},{key:"connect",value:function(e,t,n,o){var r=this;r.handled=!1,r.callback=e,r.ws=new c.a(r.endpoint,"Mixin-OAuth-1",{maxReconnectionDelay:5e3,minReconnectionDelay:1e3,reconnectionDelayGrowFactor:1.2,connectionTimeout:8e3,maxRetries:1/0,debug:!1}),r.ws.addEventListener("message",(function(e){if(!r.handled){var c=new FileReader;c.onload=function(){var e=Object(d.ungzip)(new Uint8Array(this.result),{to:"string"}),c=JSON.parse(e);r.callback(c)?r.handled=!0:setTimeout((function(){r.sendRefreshCode(t,n,o,c.data)}),1e3)},c.readAsArrayBuffer(e.data)}})),r.ws.addEventListener("open",(function(e){r.sendRefreshCode(t,n,o)}))}},{key:"sendRefreshCode",value:function(e,t,n,o){this.handled||this.send({id:Object(f.a)().toUpperCase(),action:"REFRESH_OAUTH_CODE",params:{client_id:e,scope:t,code_challenge:n,authorization_id:o?o.authorization_id:""}})}},{key:"send",value:function(e){try{this.ws.send(Object(l.gzip)(JSON.stringify(e)))}catch(e){e instanceof DOMException||console.error(e)}}}]),e}()},1400:function(e,t,n){"use strict";n(1377)},1401:function(e,t,n){var o=n(35)(!1);o.push([e.i,".mixin-logo-overlay[data-v-36e3777e]{border-radius:8px;background-color:#fff}.oauth-qr-background[data-v-36e3777e]{border-radius:8px;background-color:#f2f3f6}.oauth-qr-scanned[data-v-36e3777e]{color:#4caf50;background-color:#e8f5e9;border-radius:50%}.oauth-guide-title[data-v-36e3777e]{font-size:18px;font-weight:600;line-height:21px}.oauth-guide-text[data-v-36e3777e]{color:grey;font-size:14px;font-weight:500px;line-height:150%}",""]),e.exports=o},1495:function(e,t){}}]);